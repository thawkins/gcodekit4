//! Spoilboard Grid Dialog
//! Dialog for capturing parameters to generate a laser grid on the spoilboard

import { Button, LineEdit, VerticalBox, HorizontalBox, GridBox, GroupBox, ScrollView, ComboBox } from "std-widgets.slint";

export component SpoilboardGridDialog inherits Window {
    title: "Create Spoilboard Grid";
    width: 600px;
    height: 550px;
    always-on-top: true;
    
    in property <[string]> devices: [];
    in-out property <int> selected-device-index: -1;
    
    in-out property <string> width-mm: "300.0";
    in-out property <string> height-mm: "180.0";
    in-out property <string> grid-spacing: "10.0";
    in-out property <string> feed-rate: "1000";
    in-out property <string> laser-power: "255";
    in-out property <string> laser-mode: "M3"; // "M3" or "M4"
    in property <string> unit-label: "mm";
    
    callback generate-gcode();
    callback cancel-dialog();
    callback device-selected(int);
    
    VerticalBox {
        padding: 20px;
        spacing: 15px;
        
        ScrollView {
            vertical-stretch: 1;
            
            VerticalBox {
                spacing: 15px;
                
                // Quick Load
                GroupBox {
                    title: "Quick Load";
                    
                    GridBox {
                        spacing: 10px;
                        
                        Row {
                            Text { text: "From Device:"; vertical-alignment: center; }
                            ComboBox {
                                model: devices;
                                current-index <=> selected-device-index;
                                selected => {
                                    root.device-selected(self.current-index);
                                }
                            }
                        }
                    }
                }
                
                // Dimensions
                GroupBox {
                    title: "Grid Area (" + root.unit-label + ")";
                    
                    GridBox {
                        spacing: 10px;
                        
                        Row {
                            Text { text: "Width (X):"; }
                            LineEdit { 
                                text <=> width-mm;
                                placeholder-text: "300.0";
                                input-type: text;
                            }
                        }
                        
                        Row {
                            Text { text: "Height (Y):"; }
                            LineEdit { 
                                text <=> height-mm;
                                placeholder-text: "180.0";
                                input-type: text;
                            }
                        }
                    }
                }
                
                // Grid Settings
                GroupBox {
                    title: "Grid Settings";
                    
                    GridBox {
                        spacing: 10px;
                        
                        Row {
                            Text { text: "Grid Spacing (" + root.unit-label + "):"; }
                            LineEdit { 
                                text <=> grid-spacing;
                                placeholder-text: "10.0";
                                input-type: text;
                            }
                        }
                    }
                }
                
                // Laser Parameters
                GroupBox {
                    title: "Laser Parameters";
                    
                    GridBox {
                        spacing: 10px;
                        
                        Row {
                            Text { text: "Feed Rate (" + root.unit-label + "/min):"; }
                            LineEdit { 
                                text <=> feed-rate;
                                placeholder-text: "1000";
                                input-type: text;
                            }
                        }
                        
                        Row {
                            Text { text: "Laser Power (S-Value):"; }
                            LineEdit { 
                                text <=> laser-power;
                                placeholder-text: "255";
                                input-type: text;
                            }
                        }
                        
                        Row {
                            Text { text: "Laser Mode:"; vertical-alignment: center; }
                            ComboBox {
                                model: ["Constant Power (M3)", "Dynamic Power (M4)"];
                                current-index: root.laser-mode == "M3" ? 0 : 1;
                                selected => {
                                    if (self.current-index == 0) {
                                        root.laser-mode = "M3";
                                    } else {
                                        root.laser-mode = "M4";
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
        
        // Action Buttons
        FocusScope {
            key-pressed(event) => {
                if (event.text == Key.Return) {
                    root.generate-gcode();
                    return accept;
                }
                return reject;
            }
            
            HorizontalBox {
                spacing: 10px;
                horizontal-stretch: 0;
                alignment: end;
                
                Button {
                    text: "Cancel";
                    clicked => {
                        root.cancel-dialog();
                    }
                }
                
                Button {
                    text: "Generate";
                    primary: true;
                    clicked => {
                        root.generate-gcode();
                    }
                }
            }
        }
    }
}
