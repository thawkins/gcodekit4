//! Tabbed Box Maker Dialog
//! Dialog for capturing parameters based on boxes.py algorithm

import { Button, LineEdit, ComboBox, CheckBox, VerticalBox, HorizontalBox, GridBox, ScrollView, GroupBox } from "std-widgets.slint";

export component TabbedBoxDialog inherits Window {
    title: "Tabbed Box Maker (boxes.py algorithm)";
    width: 600px;
    height: 750px;
    always-on-top: true;
    
    in-out property <string> box-x: "100.0";
    in-out property <string> box-y: "100.0";
    in-out property <string> box-h: "100.0";
    in-out property <string> material-thickness: "3.0";
    in-out property <string> burn: "0.1";
    in-out property <string> finger-width: "2.0";
    in-out property <string> space-width: "2.0";
    in-out property <string> surrounding-spaces: "2.0";
    in-out property <string> play: "0.0";
    in-out property <string> extra-length: "0.0";
    in-out property <string> dimple-height: "0.0";
    in-out property <string> dimple-length: "0.0";
    in-out property <int> finger-style: 0;
    in-out property <int> box-type: 0;
    in-out property <bool> outside-dimensions: false;
    in-out property <string> laser-passes: "3";
    in-out property <string> laser-power: "1000";
    in-out property <string> feed-rate: "500";
    in-out property <string> offset-x: "10.0";
    in-out property <string> offset-y: "10.0";
    in-out property <string> dividers-x: "0";
    in-out property <string> dividers-y: "0";
    in-out property <bool> optimize-layout: false;
    in-out property <int> key-divider-type: 0;
    in property <string> unit-label: "mm";
    
    callback generate-box();
    callback cancel-dialog();
    callback load-params();
    callback save-params();
    
    VerticalBox {
        padding: 20px;
        spacing: 15px;
        
        ScrollView {
            vertical-stretch: 1;
            
            VerticalBox {
                spacing: 15px;
                
                // Box Dimensions
                GroupBox {
                    title: "Box Dimensions (" + root.unit-label + ")";
                    
                    GridBox {
                        spacing: 10px;
                        
                        Row {
                            Text { text: "X (Width):"; }
                            LineEdit { 
                                text <=> box-x;
                                placeholder-text: "100.0";
                                input-type: text;
                            }
                        }
                        
                        Row {
                            Text { text: "Y (Depth):"; }
                            LineEdit { 
                                text <=> box-y;
                                placeholder-text: "100.0";
                                input-type: text;
                            }
                        }
                        
                        Row {
                            Text { text: "H (Height):"; }
                            LineEdit { 
                                text <=> box-h;
                                placeholder-text: "100.0";
                                input-type: text;
                            }
                        }
                        
                        Row {
                            Text { text: "Outside Dims:"; }
                            CheckBox { 
                                checked <=> outside-dimensions;
                            }
                        }
                    }
                }
                
                // Material Settings
                GroupBox {
                    title: "Material Settings";
                    
                    GridBox {
                        spacing: 10px;
                        
                        Row {
                            Text { text: "Thickness (" + root.unit-label + "):"; }
                            LineEdit { 
                                text <=> material-thickness;
                                placeholder-text: "3.0";
                                input-type: text;
                            }
                        }
                        
                        Row {
                            Text { text: "Burn / Tool Dia (" + root.unit-label + "):"; }
                            LineEdit { 
                                text <=> burn;
                                placeholder-text: "0.1";
                                input-type: text;
                            }
                        }
                    }
                }
                
                // Finger Joint Settings
                GroupBox {
                    title: "Finger Joint Settings (multiples of thickness)";
                    
                    GridBox {
                        spacing: 10px;
                        
                        Row {
                            Text { text: "Finger Width:"; }
                            LineEdit { 
                                text <=> finger-width;
                                placeholder-text: "2.0";
                            }
                        }
                        
                        Row {
                            Text { text: "Space Width:"; }
                            LineEdit { 
                                text <=> space-width;
                                placeholder-text: "2.0";
                            }
                        }
                        
                        Row {
                            Text { text: "Surrounding Spaces:"; }
                            LineEdit { 
                                text <=> surrounding-spaces;
                                placeholder-text: "2.0";
                            }
                        }
                        
                        Row {
                            Text { text: "Play (fit tolerance):"; }
                            LineEdit { 
                                text <=> play;
                                placeholder-text: "0.0";
                            }
                        }
                        
                        Row {
                            Text { text: "Extra Length:"; }
                            LineEdit { 
                                text <=> extra-length;
                                placeholder-text: "0.0";
                            }
                        }

                        Row {
                            Text { text: "Dimple Height:"; }
                            LineEdit { 
                                text <=> dimple-height;
                                placeholder-text: "0.0";
                            }
                        }

                        Row {
                            Text { text: "Dimple Length:"; }
                            LineEdit { 
                                text <=> dimple-length;
                                placeholder-text: "0.0";
                            }
                        }

                        Row {
                            Text { text: "Finger Style:"; }
                            ComboBox {
                                model: ["Rectangular", "Springs", "Barbs", "Snap", "Dogbone"];
                                current-index <=> finger-style;
                            }
                        }
                    }
                }
                
                // Box Configuration
                GroupBox {
                    title: "Box Configuration";
                    
                    GridBox {
                        spacing: 10px;
                        
                        Row {
                            Text { text: "Box Type:"; }
                            ComboBox {
                                model: ["Full Box", "No Top", "No Bottom", "No Sides", "No Front/Back", "No Left/Right"];
                                current-index <=> box-type;
                            }
                        }

                        Row {
                            Text { text: "Dividers X:"; }
                            LineEdit { 
                                text <=> dividers-x;
                                placeholder-text: "0";
                                input-type: number;
                            }
                        }

                        Row {
                            Text { text: "Dividers Y:"; }
                            LineEdit { 
                                text <=> dividers-y;
                                placeholder-text: "0";
                                input-type: number;
                            }
                        }

                        Row {
                            Text { text: "Divider Keying:"; }
                            ComboBox {
                                model: ["Walls & Floor", "Walls Only", "Floor Only", "None"];
                                current-index <=> key-divider-type;
                            }
                        }

                        Row {
                            Text { text: "Optimize Layout:"; }
                            CheckBox { 
                                checked <=> optimize-layout;
                            }
                        }
                    }
                }
                
                // Laser Settings
                GroupBox {
                    title: "Laser Settings";
                    
                    GridBox {
                        spacing: 10px;
                        
                        Row {
                            Text { text: "Passes:"; }
                            LineEdit { 
                                text <=> laser-passes;
                                placeholder-text: "3";
                            }
                        }
                        
                        Row {
                            Text { text: "Power (S):"; }
                            LineEdit { 
                                text <=> laser-power;
                                placeholder-text: "1000";
                            }
                        }
                        
                        Row {
                            Text { text: "Feed Rate:"; }
                            LineEdit { 
                                text <=> feed-rate;
                                placeholder-text: "500";
                            }
                        }
                    }
                }
                
                // Work Origin Offsets
                GroupBox {
                    title: "Work Origin Offsets (" + root.unit-label + ")";
                    
                    GridBox {
                        spacing: 10px;
                        
                        Row {
                            Text { text: "Offset X:"; }
                            LineEdit { 
                                text <=> offset-x;
                                placeholder-text: "10.0";
                                input-type: text;
                            }
                        }
                        
                        Row {
                            Text { text: "Offset Y:"; }
                            LineEdit { 
                                text <=> offset-y;
                                placeholder-text: "10.0";
                                input-type: text;
                            }
                        }
                    }
                }
            }
        }
        
        // Action Buttons
        FocusScope {
            key-pressed(event) => {
                if (event.text == Key.Return) {
                    root.generate-box();
                    return accept;
                }
                return reject;
            }
            
            HorizontalBox {
                spacing: 10px;
                horizontal-stretch: 0;
                alignment: end;
                
                Button {
                    text: "Load";
                    clicked => {
                        root.load-params();
                    }
                }

                Button {
                    text: "Save";
                    clicked => {
                        root.save-params();
                    }
                }

                Button {
                    text: "Cancel";
                    clicked => {
                        root.cancel-dialog();
                    }
                }
                
                Rectangle {
                    Button {
                        text: "Generate";
                        primary: true;
                        clicked => {
                            root.generate-box();
                        }
                    }
                    
                    TouchArea {
                        clicked => {
                            root.generate-box();
                        }
                    }
                }
            }
        }
    }
}
