//! Jigsaw Puzzle Maker Dialog
//! Dialog for capturing parameters to generate a jigsaw puzzle

import { Button, LineEdit, VerticalBox, HorizontalBox, GridBox, GroupBox, ScrollView } from "std-widgets.slint";

export component JigsawPuzzleDialog inherits Window {
    title: "Jigsaw Puzzle Maker";
    width: 500px;
    height: 600px;
    always-on-top: true;
    
    in-out property <string> puzzle-width: "200.0";
    in-out property <string> puzzle-height: "150.0";
    in-out property <string> pieces-across: "4";
    in-out property <string> pieces-down: "3";
    in-out property <string> kerf: "0.5";
    in-out property <string> laser-passes: "3";
    in-out property <string> laser-power: "1000";
    in-out property <string> feed-rate: "500";
    in-out property <string> seed: "42";
    in-out property <string> tab-size: "20.0";
    in-out property <string> jitter: "4.0";
    in-out property <string> corner-radius: "2.0";
    in-out property <string> offset-x: "10.0";
    in-out property <string> offset-y: "10.0";
    in property <string> unit-label: "mm";
    
    callback generate-puzzle();
    callback cancel-dialog();
    callback load-params();
    callback save-params();
    
    VerticalBox {
        padding: 20px;
        spacing: 15px;
        
        ScrollView {
            vertical-stretch: 1;
            
            VerticalBox {
                spacing: 15px;
                
                // Puzzle Dimensions
            GroupBox {
                title: "Puzzle Dimensions (" + root.unit-label + ")";
                
                GridBox {
                    spacing: 10px;
                    
                    Row {
                        Text { text: "Width:"; }
                        LineEdit { 
                            text <=> puzzle-width;
                            placeholder-text: "200.0";
                            input-type: text;
                        }
                    }
                    
                    Row {
                        Text { text: "Height:"; }
                        LineEdit { 
                            text <=> puzzle-height;
                            placeholder-text: "150.0";
                            input-type: text;
                        }
                    }
                }
            }
            
            // Puzzle Grid
            GroupBox {
                title: "Puzzle Grid";
                
                GridBox {
                    spacing: 10px;
                    
                    Row {
                        Text { text: "Pieces Across:"; }
                        LineEdit { 
                            text <=> pieces-across;
                            placeholder-text: "4";
                            input-type: number;
                        }
                    }
                    
                    Row {
                        Text { text: "Pieces Down:"; }
                        LineEdit { 
                            text <=> pieces-down;
                            placeholder-text: "3";
                            input-type: number;
                        }
                    }
                    
                    Row {
                        Text { 
                            text: "Total Pieces:"; 
                            color: #888;
                        }
                        Text { 
                            text: pieces-across + " Ã— " + pieces-down + " = " + 
                                  (pieces-across.to-float() * pieces-down.to-float());
                            color: #0af;
                        }
                    }
                }
            }
            
            // Material Settings
            GroupBox {
                title: "Material Settings";
                
                GridBox {
                    spacing: 10px;
                    
                    Row {
                        Text { text: "Kerf (" + root.unit-label + "):"; }
                        LineEdit { 
                            text <=> kerf;
                            placeholder-text: "0.5";
                            input-type: text;
                        }
                    }
                    
                    Row {
                        Text { text: "Corner Radius (" + root.unit-label + "):"; }
                        LineEdit { 
                            text <=> corner-radius;
                            placeholder-text: "2.0";
                            input-type: text;
                        }
                    }
                }
            }
            
            // Puzzle Design
            GroupBox {
                title: "Puzzle Design";
                
                GridBox {
                    spacing: 10px;
                    
                    Row {
                        Text { text: "Seed:"; }
                        LineEdit { 
                            text <=> seed;
                            placeholder-text: "42";
                            input-type: number;
                        }
                    }
                    
                    Row {
                        Text { text: "Tab Size (%):"; }
                        LineEdit { 
                            text <=> tab-size;
                            placeholder-text: "20.0";
                            input-type: decimal;
                        }
                    }
                    
                    Row {
                        Text { text: "Jitter (%):"; }
                        LineEdit { 
                            text <=> jitter;
                            placeholder-text: "4.0";
                            input-type: decimal;
                        }
                    }
                }
            }
            
            // Laser Settings
            GroupBox {
                title: "Laser Settings";
                
                GridBox {
                    spacing: 10px;
                    
                    Row {
                        Text { text: "Passes:"; }
                        LineEdit { 
                            text <=> laser-passes;
                            placeholder-text: "3";
                            input-type: number;
                        }
                    }
                    
                    Row {
                        Text { text: "Power (S):"; }
                        LineEdit { 
                            text <=> laser-power;
                            placeholder-text: "1000";
                            input-type: number;
                        }
                    }
                    
                    Row {
                        Text { text: "Feed Rate:"; }
                        LineEdit { 
                            text <=> feed-rate;
                            placeholder-text: "500";
                            input-type: number;
                        }
                    }
                }
            }
            
            // Work Origin Offsets
            GroupBox {
                title: "Work Origin Offsets (" + root.unit-label + ")";
                
                GridBox {
                    spacing: 10px;
                    
                    Row {
                        Text { text: "Offset X:"; }
                        LineEdit { 
                            text <=> offset-x;
                            placeholder-text: "10.0";
                            input-type: text;
                        }
                    }
                    
                    Row {
                        Text { text: "Offset Y:"; }
                        LineEdit { 
                            text <=> offset-y;
                            placeholder-text: "10.0";
                            input-type: text;
                        }
                    }
                }
            }
        }
        }
        
        // Action Buttons
        FocusScope {
            key-pressed(event) => {
                if (event.text == Key.Return) {
                    root.generate-puzzle();
                    return accept;
                }
                return reject;
            }
            
            HorizontalBox {
                spacing: 10px;
                horizontal-stretch: 0;
                alignment: end;
                
                Button {
                    text: "Load";
                    clicked => {
                        root.load-params();
                    }
                }

                Button {
                    text: "Save";
                    clicked => {
                        root.save-params();
                    }
                }

                Button {
                    text: "Cancel";
                    clicked => {
                        root.cancel-dialog();
                    }
                }
                
                Rectangle {
                    Button {
                        text: "Generate";
                        primary: true;
                        clicked => {
                            root.generate-puzzle();
                        }
                    }
                    
                    TouchArea {
                        clicked => {
                            root.generate-puzzle();
                        }
                    }
                }
            }
        }
    }
}
