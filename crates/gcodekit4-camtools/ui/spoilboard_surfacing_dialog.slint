//! Spoilboard Surfacing Dialog
//! Dialog for capturing parameters to generate a spoilboard surfacing toolpath

import { Button, LineEdit, VerticalBox, HorizontalBox, GridBox, GroupBox, ScrollView, ComboBox } from "std-widgets.slint";

export component SpoilboardSurfacingDialog inherits Window {
    title: "Spoilboard Surfacing";
    width: 600px;
    height: 650px;
    always-on-top: true;
    
    in property <[string]> devices: [];
    in property <[string]> tool-categories: [];
    in property <[string]> tools: [];
    
    in-out property <int> selected-device-index: -1;
    in-out property <int> selected-category-index: -1;
    in-out property <int> selected-tool-index: -1;
    
    in property <string> unit-label: "mm";

    in-out property <string> width-mm: "300.0";
    in-out property <string> height-mm: "180.0";
    in-out property <string> tool-diameter: "25.4";
    in-out property <string> feed-rate: "1000";
    in-out property <string> spindle-speed: "12000";
    in-out property <string> cut-depth: "0.5";
    in-out property <string> stepover: "40";
    in-out property <string> safe-z: "5.0";
    
    callback generate-gcode();
    callback cancel-dialog();
    callback device-selected(int);
    callback category-selected(int);
    callback tool-selected(int);
    
    VerticalBox {
        padding: 20px;
        spacing: 15px;
        
        ScrollView {
            vertical-stretch: 1;
            
            VerticalBox {
                spacing: 15px;
                
                // Quick Load
                GroupBox {
                    title: "Quick Load";
                    
                    GridBox {
                        spacing: 10px;
                        
                        Row {
                            Text { text: "From Device:"; vertical-alignment: center; }
                            ComboBox {
                                model: devices;
                                current-index <=> selected-device-index;
                                selected => {
                                    root.device-selected(self.current-index);
                                }
                            }
                        }
                        
                        Row {
                            Text { text: "Tool Category:"; vertical-alignment: center; }
                            ComboBox {
                                model: tool-categories;
                                current-index <=> selected-category-index;
                                selected => {
                                    root.category-selected(self.current-index);
                                }
                            }
                        }
                        
                        Row {
                            Text { text: "Select Tool:"; vertical-alignment: center; }
                            ComboBox {
                                model: tools;
                                current-index <=> selected-tool-index;
                                selected => {
                                    root.tool-selected(self.current-index);
                                }
                            }
                        }
                    }
                }
                
                // Dimensions
                GroupBox {
                    title: "Surfacing Area (" + root.unit-label + ")";
                    
                    GridBox {
                        spacing: 10px;
                        
                        Row {
                            Text { text: "Width (X) [" + root.unit-label + "]:"; }
                            LineEdit { 
                                text <=> width-mm;
                                placeholder-text: "300.0";
                                input-type: text;
                            }
                        }
                        
                        Row {
                            Text { text: "Height (Y) [" + root.unit-label + "]:"; }
                            LineEdit { 
                                text <=> height-mm;
                                placeholder-text: "180.0";
                                input-type: text;
                            }
                        }
                    }
                }
                
                // Tool Settings
                GroupBox {
                    title: "Tool Settings";
                    
                    GridBox {
                        spacing: 10px;
                        
                        Row {
                            Text { text: "Tool Diameter [" + root.unit-label + "]:"; }
                            LineEdit { 
                                text <=> tool-diameter;
                                placeholder-text: "25.4";
                                input-type: text;
                            }
                        }
                        
                        Row {
                            Text { text: "Stepover (%):"; }
                            LineEdit { 
                                text <=> stepover;
                                placeholder-text: "40";
                                input-type: decimal;
                            }
                        }
                    }
                }
                
                // Cutting Parameters
                GroupBox {
                    title: "Cutting Parameters";
                    
                    GridBox {
                        spacing: 10px;
                        
                        Row {
                            Text { text: "Feed Rate (" + root.unit-label + "/min):"; }
                            LineEdit { 
                                text <=> feed-rate;
                                placeholder-text: "1000";
                                input-type: text;
                            }
                        }
                        
                        Row {
                            Text { text: "Spindle Speed (RPM):"; }
                            LineEdit { 
                                text <=> spindle-speed;
                                placeholder-text: "12000";
                                input-type: number;
                            }
                        }
                        
                        Row {
                            Text { text: "Cut Depth [" + root.unit-label + "]:"; }
                            LineEdit { 
                                text <=> cut-depth;
                                placeholder-text: "0.5";
                                input-type: text;
                            }
                        }
                        
                        Row {
                            Text { text: "Safe Z [" + root.unit-label + "]:"; }
                            LineEdit { 
                                text <=> safe-z;
                                placeholder-text: "5.0";
                                input-type: text;
                            }
                        }
                    }
                }
            }
        }
        
        // Action Buttons
        FocusScope {
            key-pressed(event) => {
                if (event.text == Key.Return) {
                    root.generate-gcode();
                    return accept;
                }
                return reject;
            }
            
            HorizontalBox {
                spacing: 10px;
                horizontal-stretch: 0;
                alignment: end;
                
                Button {
                    text: "Cancel";
                    clicked => {
                        root.cancel-dialog();
                    }
                }
                
                Button {
                    text: "Generate";
                    primary: true;
                    clicked => {
                        root.generate-gcode();
                    }
                }
            }
        }
    }
}
