//! Speeds and Feeds Calculator Dialog
//! Dialog for calculating cutting parameters

import { Button, LineEdit, ComboBox, VerticalBox, HorizontalBox, GridBox, ScrollView, GroupBox } from "std-widgets.slint";

export component SpeedsFeedsDialog inherits Window {
    width: 500px;
    height: 600px;
    background: white;
    always-on-top: true;
    
    in property <[string]> materials: [];
    in property <[string]> tools: [];
    in property <[string]> devices: [];
    
    in-out property <int> selected-material-index: -1;
    in-out property <int> selected-tool-index: -1;
    in-out property <int> selected-device-index: -1;
    
    in property <string> result-rpm: "---";
    in property <string> result-unclamped-rpm: "";
    in property <string> result-feed: "---";
    in property <string> result-unclamped-feed: "";
    in property <string> result-surface-speed: "---";
    in property <string> result-chip-load: "---";
    in property <string> result-source: "";
    in property <string> result-warnings: "";
    in property <string> unit-label: "mm";
    
    callback calculate();
    callback close-dialog();
    
    VerticalBox {
        padding: 20px;
        spacing: 15px;
        
        Text {
            text: "Speeds and Feeds Calculator";
            font-size: 18px;
            font-weight: 700;
        }
        
        ScrollView {
            vertical-stretch: 1;
            
            VerticalBox {
                spacing: 15px;
                
                // Inputs
                GroupBox {
                    title: "Selection";
                    
                    GridBox {
                        spacing: 10px;
                        
                        Row {
                            Text { text: "Material:"; vertical-alignment: center; }
                            ComboBox {
                                model: materials;
                                current-index <=> selected-material-index;
                                selected => { root.calculate(); }
                            }
                        }
                        
                        Row {
                            Text { text: "Tool:"; vertical-alignment: center; }
                            ComboBox {
                                model: tools;
                                current-index <=> selected-tool-index;
                                selected => { root.calculate(); }
                            }
                        }
                        
                        Row {
                            Text { text: "Device:"; vertical-alignment: center; }
                            ComboBox {
                                model: devices;
                                current-index <=> selected-device-index;
                                selected => { root.calculate(); }
                            }
                        }
                    }
                }
                
                // Results
                GroupBox {
                    title: "Calculated Parameters";
                    
                    GridBox {
                        spacing: 10px;
                        
                        Row {
                            Text { text: "Spindle Speed (RPM):"; font-weight: 700; }
                            HorizontalBox {
                                spacing: 5px;
                                Text { text: result-rpm; font-size: 16px; color: #2980b9; }
                                if (result-unclamped-rpm != "") : Text { 
                                    text: "(" + result-unclamped-rpm + ")"; 
                                    font-size: 16px; 
                                    color: #e74c3c; 
                                }
                            }
                        }
                        
                        Row {
                            Text { text: "Feed Rate (" + root.unit-label + "/min):"; font-weight: 700; }
                            HorizontalBox {
                                spacing: 5px;
                                Text { text: result-feed; font-size: 16px; color: #2980b9; }
                                if (result-unclamped-feed != "") : Text { 
                                    text: "(" + result-unclamped-feed + ")"; 
                                    font-size: 16px; 
                                    color: #e74c3c; 
                                }
                            }
                        }
                    }
                }
                
                // Details
                GroupBox {
                    title: "Calculation Details";
                    
                    GridBox {
                        spacing: 10px;
                        
                        Row {
                            Text { text: "Surface Speed:"; }
                            Text { text: result-surface-speed; }
                        }
                        
                        Row {
                            Text { text: "Chip Load:"; }
                            Text { text: result-chip-load; }
                        }
                        
                        Row {
                            Text { text: "Source:"; }
                            Text { text: result-source; wrap: word-wrap; }
                        }
                    }
                }
                
                // Warnings
                if (result-warnings != "") : Rectangle {
                    background: #fef9e7;
                    border-color: #f1c40f;
                    border-width: 1px;
                    border-radius: 4px;
                    
                    VerticalBox {
                        padding: 10px;
                        Text { 
                            text: "Warnings:"; 
                            font-weight: 700; 
                            color: #d35400;
                        }
                        Text { 
                            text: result-warnings; 
                            wrap: word-wrap;
                            color: #d35400;
                        }
                    }
                }
            }
        }
        
        HorizontalBox {
            alignment: end;
            Button {
                text: "Close";
                clicked => { root.close-dialog(); }
            }
        }
    }
}
