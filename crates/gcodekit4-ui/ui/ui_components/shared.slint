import { Button, LineEdit, CheckBox, SpinBox, VerticalBox, HorizontalBox } from "std-widgets.slint";
import { Theme } from "../theme.slint";

export component StandardTooltip inherits Rectangle {
    in property <string> text;
    in property <bool> show;
    
    width: tt-text.preferred-width + 10px;
    height: 24px;
    background: #222222;
    border-radius: 3px;
    border-width: 1px;
    border-color: #555555;
    visible: root.show && root.text != "";
    z: 100;
    
    tt-text := Text {
        text: root.text;
        color: white;
        font-size: 11px;
        vertical-alignment: center;
        horizontal-alignment: center;
    }
}

export component StandardButton inherits Rectangle {
    in property <string> text;
    in property <string> icon;
    in property <string> tooltip;
    in property <bool> enabled: true;
    in property <bool> primary: false;
    in property <bool> destructive: false;
    in property <bool> checkable: false;
    in property <bool> checked: false;
    
    callback clicked;
    
    height: Theme.button-height;
    border-radius: Theme.border-radius;
    
    background: !root.enabled ? Theme.secondary-pressed : 
                (root.checked ? Theme.primary-pressed :
                (touch.pressed ? (root.primary ? Theme.primary-pressed : (root.destructive ? Theme.danger-hover : Theme.secondary-pressed)) : 
                (touch.has-hover ? (root.primary ? Theme.primary-hover : (root.destructive ? Theme.danger-hover : Theme.secondary-hover)) : 
                (root.primary ? Theme.primary : (root.destructive ? Theme.danger : Theme.secondary)))));

    opacity: root.enabled ? 1.0 : 0.5;
    border-width: root.checked ? 1px : 0px;
    border-color: root.checked ? Theme.text-primary : transparent;
    
    HorizontalBox {
        padding: 5px;
        spacing: 8px;
        alignment: center;
        
        if (root.icon != "") : Text {
            text: root.icon;
            font-size: 18px;
            color: Theme.text-primary;
            vertical-alignment: center;
        }
        
        if (root.text != "") : Text {
            text: root.text;
            color: Theme.text-primary;
            font-size: 13px;
            vertical-alignment: center;
            horizontal-alignment: center;
        }
    }
    
    touch := TouchArea {
        mouse-cursor: root.enabled ? pointer : default;
        clicked => { 
            if (root.enabled) {
                root.clicked();
            }
        }
    }
    
    StandardTooltip {
        text: root.tooltip;
        show: touch.has-hover;
        y: parent.height + 5px;
        x: (parent.width - self.width) / 2;
    }
}

export component StandardInput inherits Rectangle {
    in-out property <string> text <=> input.text;
    in property <string> placeholder-text <=> input.placeholder-text;
    in property <bool> enabled <=> input.enabled;
    in property <InputType> input-type <=> input.input-type;
    callback edited(string);
    callback accepted(string);
    
    height: Theme.input-height;
    background: Theme.input-background;
    border-radius: Theme.border-radius;
    border-width: 1px;
    border-color: input.has-focus ? Theme.input-focus-border : Theme.input-border;
    
    input := LineEdit {
        width: 100%;
        height: 100%;
        font-size: 13px;
        edited(s) => { root.edited(s); }
        accepted(s) => { root.accepted(s); }
    }
}

export component StandardCheckBox inherits HorizontalBox {
    in property <string> text;
    in-out property <bool> checked;
    callback toggled;
    
    spacing: 5px;
    padding: 0px;
    alignment: start;
    
    CheckBox {
        checked <=> root.checked;
        toggled => { root.toggled(); }
    }
    
    Text {
        text: root.text;
        color: Theme.text-secondary;
        vertical-alignment: center;
        font-size: 13px;
    }
}

export component StandardSpinBox inherits Rectangle {
    in-out property <int> value <=> spin.value;
    in property <int> minimum <=> spin.minimum;
    in property <int> maximum <=> spin.maximum;
    
    height: Theme.input-height;
    background: Theme.input-background;
    border-radius: Theme.border-radius;
    border-width: 1px;
    border-color: Theme.input-border;
    
    spin := SpinBox {
        width: 100%;
        height: 100%;
    }
}

export component StandardFloatSpinBox inherits Rectangle {
    in-out property <float> value;
    in property <float> minimum: 0;
    in property <float> maximum: 100;
    in property <float> step: 1.0;
    in property <bool> enabled: true;
    
    callback value-changed(float);
    
    height: Theme.input-height;
    background: enabled ? Theme.input-background : Theme.secondary-pressed;
    border-width: 1px;
    border-color: Theme.input-border;
    border-radius: Theme.border-radius;
    
    HorizontalBox {
        padding: 0px;
        spacing: 0px;
        
        Rectangle {
            horizontal-stretch: 1;
            
            text-input := TextInput {
                text: Math.round(value * 100.0) / 100.0;
                horizontal-alignment: center;
                vertical-alignment: center;
                font-size: 13px;
                enabled: root.enabled;
                color: root.enabled ? Theme.text-primary : Theme.text-muted;
                
                edited => {
                    if (self.text != "") {
                        value = max(minimum, min(maximum, self.text.to-float()));
                        value-changed(value);
                    }
                }
            }
        }
        
        VerticalBox {
            padding: 0px;
            spacing: 0px;
            width: 15px;
            
            Rectangle {
                height: parent.height / 2;
                background: up-touch.has-hover && root.enabled ? Theme.secondary-hover : transparent;
                border-width: 0px;
                
                Text {
                    text: "▲";
                    font-size: 8px;
                    horizontal-alignment: center;
                    vertical-alignment: center;
                    color: root.enabled ? Theme.text-secondary : Theme.text-muted;
                }
                
                up-touch := TouchArea {
                    enabled: root.enabled;
                    clicked => {
                        if (value < maximum) {
                            value = min(maximum, value + step);
                            value-changed(value);
                        }
                    }
                }
            }
            
            Rectangle {
                height: parent.height / 2;
                background: down-touch.has-hover && root.enabled ? Theme.secondary-hover : transparent;
                border-width: 0px;
                
                Text {
                    text: "▼";
                    font-size: 8px;
                    horizontal-alignment: center;
                    vertical-alignment: center;
                    color: root.enabled ? Theme.text-secondary : Theme.text-muted;
                }
                
                down-touch := TouchArea {
                    enabled: root.enabled;
                    clicked => {
                        if (value > minimum) {
                            value = max(minimum, value - step);
                            value-changed(value);
                        }
                    }
                }
            }
        }
    }
}

export component StandardSidebar inherits Rectangle {
    width: Theme.sidebar-width;
    background: Theme.sidebar-background;
    
    // Right border separator
    Rectangle {
        width: 1px;
        height: 100%;
        x: parent.width - 1px;
        background: Theme.border;
    }
}
