//! CAM Tools Panel
//! Provides a collection of CAM (Computer-Aided Manufacturing) tools and utilities

import { Button, VerticalBox, HorizontalBox, ScrollView, GridBox } from "std-widgets.slint";
import { Theme } from "../ui/theme.slint";
import { StandardTooltip } from "../ui/ui_components/shared.slint";

component GeneratedIcon inherits Rectangle {
    in property <string> type;
    background: transparent;
    
    if type == "box" : Path {
        width: 100%; height: 100%;
        commands: "M 20 20 L 40 20 L 40 30 L 60 30 L 60 20 L 80 20 L 80 80 L 60 80 L 60 70 L 40 70 L 40 80 L 20 80 Z";
        stroke: Theme.primary; stroke-width: 2px; fill: #3498db20;
    }
    
    if type == "puzzle" : Path {
        width: 100%; height: 100%;
        commands: "M 30 30 L 45 30 C 45 20 55 20 55 30 L 70 30 L 70 45 C 80 45 80 55 70 55 L 70 70 L 55 70 C 55 80 45 80 45 70 L 30 70 L 30 55 C 20 55 20 45 30 45 Z";
        stroke: Theme.danger; stroke-width: 2px; fill: #e74c3c20;
    }
    
    if type == "bitmap" : Rectangle {
        width: 60%; height: 60%;
        border-radius: 30px;
        border-width: 2px;
        border-color: #9b59b6;
        background: @radial-gradient(circle, #9b59b6 0%, #9b59b600 100%);
    }
    
    if type == "vector" : Path {
        width: 100%; height: 100%;
        commands: "M 20 80 C 20 20 80 20 80 80";
        stroke: Theme.success; stroke-width: 3px; fill: transparent;
    }
    
    if type == "speeds" : Path {
        width: 100%; height: 100%;
        commands: "M 50 50 L 50 20 M 50 50 L 70 70 M 50 10 A 40 40 0 1 1 10 50";
        stroke: Theme.warning; stroke-width: 3px; fill: transparent;
    }
    
    if type == "surface" : Path {
        width: 100%; height: 100%;
        commands: "M 10 20 L 90 20 L 90 35 L 10 35 L 10 50 L 90 50 L 90 65 L 10 65 L 10 80 L 90 80";
        stroke: #e67e22; stroke-width: 2px; fill: transparent;
    }
    
    if type == "grid" : Path {
        width: 100%; height: 100%;
        commands: "M 30 10 L 30 90 M 50 10 L 50 90 M 70 10 L 70 90 M 10 30 L 90 30 M 10 50 L 90 50 M 10 70 L 90 70";
        stroke: #1abc9c; stroke-width: 2px; fill: transparent;
    }
    
    if type == "unknown" : Text {
        text: "?";
        font-size: 40px;
        color: Theme.text-muted;
    }
}

component ToolCard inherits Rectangle {
    in property <string> tool-title: "Tool";
    in property <string> tool-description: "Description";
    in property <string> icon-type: "unknown";
    in property <string> tooltip;
    
    callback clicked();
    
    background: Theme.sidebar-background;
    border-radius: 8px;
    border-width: 1px;
    border-color: Theme.sidebar-item-selected;
    height: 200px;
    
    VerticalBox {
        padding: 15px;
        spacing: 10px;
        
        Rectangle {
            height: 80px;
            width: 80px;
            x: (parent.width - self.width) / 2;
            GeneratedIcon {
                type: root.icon-type;
            }
        }
        
        Text {
            text: root.tool-title;
            font-size: 18px;
            font-weight: 600;
            color: Theme.text-primary;
            horizontal-alignment: center;
        }
        
        Text {
            text: root.tool-description;
            font-size: 14px;
            color: Theme.text-secondary;
            wrap: word-wrap;
            horizontal-alignment: center;
            vertical-alignment: top;
        }
    }
    
    touch := TouchArea {
        clicked => { root.clicked(); }
    }
    
    StandardTooltip {
        text: root.tooltip != "" ? root.tooltip : "Open " + root.tool-title;
        show: touch.has-hover; y: parent.height + 5px; x: (parent.width - self.width) / 2;
    }
}

export component CAMToolsPanel inherits Rectangle {
    background: Theme.background;
    
    callback open-tabbed-box-maker();
    callback open-jigsaw-puzzle-maker();
    callback open-laser-engraver();
    callback open-vector-engraver();
    callback open-speeds-feeds-calculator();
    callback open-spoilboard-surfacing();
    callback open-spoilboard-grid();
    
    VerticalBox {
        padding: 20px;
        spacing: 20px;
        
        Text {
            text: "CAM Tools";
            font-size: 24px;
            font-weight: 700;
            color: Theme.text-primary;
        }
        
        ScrollView {
            viewport-width: 1000px;
            GridLayout {
                spacing: 20px;
                padding: 10px;
                
                Row {
                    ToolCard {
                        tool-title: "Tabbed Box Maker";
                        tool-description: "Generate G-code for laser/CNC cut boxes with finger joints";
                        icon-type: "box";
                        clicked => { root.open-tabbed-box-maker(); }
                    }
                    ToolCard {
                        tool-title: "Jigsaw Puzzle Generator";
                        tool-description: "Create custom jigsaw puzzle patterns from images";
                        icon-type: "puzzle";
                        clicked => { root.open-jigsaw-puzzle-maker(); }
                    }
                    ToolCard {
                        tool-title: "Laser Image Engraver";
                        tool-description: "Convert raster images to G-code for laser engraving";
                        icon-type: "bitmap";
                        clicked => { root.open-laser-engraver(); }
                    }
                }
                
                Row {
                    ToolCard {
                        tool-title: "Laser Vector Engraver";
                        tool-description: "Convert SVG and DXF vector files to G-code";
                        icon-type: "vector";
                        clicked => { root.open-vector-engraver(); }
                    }
                    ToolCard {
                        tool-title: "Speeds & Feeds Calculator";
                        tool-description: "Calculate optimal cutting speeds and feeds for your materials";
                        icon-type: "speeds";
                        clicked => { root.open-speeds-feeds-calculator(); }
                    }
                    ToolCard {
                        tool-title: "Spoilboard Surfacing";
                        tool-description: "Generate surfacing toolpaths to flatten your spoilboard";
                        icon-type: "surface";
                        clicked => { root.open-spoilboard-surfacing(); }
                    }
                }
                
                Row {
                    ToolCard {
                        tool-title: "Create Spoilboard Grid";
                        tool-description: "Generate a laser grid pattern on your spoilboard for alignment";
                        icon-type: "grid";
                        clicked => { root.open-spoilboard-grid(); }
                    }
                    Rectangle {} // Spacer
                    Rectangle {} // Spacer
                }
            }
        }
    }
}
