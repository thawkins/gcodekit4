/// Device Console Panel Component
/// Displays device console output with clear and copy buttons

import { Button, TextEdit, LineEdit, VerticalBox, HorizontalBox, ScrollView } from "std-widgets.slint";

component ConsoleToolButton inherits Rectangle {
    in property <string> text;
    in property <string> icon;
    in property <string> tooltip;
    in property <bool> enabled: true;
    in property <brush> base-color: #34495e;
    in property <brush> hover-color: #3d566e;
    
    callback clicked;
    
    height: 40px;
    background: !root.enabled ? #2c3e50 : (touch.has-hover ? root.hover-color : root.base-color);
    border-radius: 4px;
    opacity: root.enabled ? 1.0 : 0.5;
    
    HorizontalBox {
        padding: 5px;
        spacing: 8px;
        alignment: center;
        
        if (root.icon != "") : Text {
            text: root.icon;
            font-size: 18px;
            color: #ecf0f1;
            vertical-alignment: center;
        }
        
        if (root.text != "") : Text {
            text: root.text;
            font-size: 13px;
            color: #ecf0f1;
            vertical-alignment: center;
        }
    }
    
    touch := TouchArea {
        enabled: root.enabled;
        clicked => { root.clicked(); }
    }

    if (touch.has-hover && root.tooltip != "") : Rectangle {
        y: parent.height + 5px;
        x: (parent.width - self.width) / 2;
        width: tt-text.preferred-width + 10px;
        height: 24px;
        background: #222222;
        border-radius: 3px;
        border-width: 1px;
        border-color: #555555;
        z: 100;
        tt-text := Text {
            text: root.tooltip;
            color: white;
            font-size: 11px;
            vertical-alignment: center;
            horizontal-alignment: center;
        }
    }
}

export component DeviceConsolePanel inherits Rectangle {
    horizontal-stretch: 1.0;
    vertical-stretch: 1.0;
    background: #1e1e1e;
    
    in property <string> console-output: "";
    in property <bool> connected: false;
    in-out property <string> command-input: "";
    
    callback console-clear-clicked();
    callback console-copy-clicked();
    callback send-command(string);

    HorizontalLayout {
        spacing: 0px;

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // LEFT SIDEBAR: Actions
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        Rectangle {
            width: 200px;
            background: #2c3e50;
            
            VerticalLayout {
                padding: 10px;
                spacing: 10px;
                alignment: start;
                
                Text {
                    text: "Console Actions";
                    font-weight: 700;
                    font-size: 12px;
                    color: #bdc3c7;
                }
                
                ConsoleToolButton {
                    text: "Clear";
                    icon: "ðŸ—‘";
                    tooltip: "Clear Console Output";
                    clicked => { root.console-clear-clicked(); }
                }
                
                ConsoleToolButton {
                    text: "Copy";
                    icon: "ðŸ“‹";
                    tooltip: "Copy to Clipboard";
                    clicked => { root.console-copy-clicked(); }
                }
            }
            
            // Right border separator
            Rectangle {
                width: 1px;
                height: 100%;
                x: parent.width - 1px;
                background: #34495e;
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // MAIN AREA: Log & Input
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        Rectangle {
            background: #1e1e1e;
            
            VerticalLayout {
                padding: 10px;
                spacing: 10px;
                
                // Console Output
                Rectangle {
                    background: #1e1e1e;
                    vertical-stretch: 1;
                    
                    ScrollView {
                        width: 100%;
                        height: 100%;
                        viewport-width: parent.width;
                        
                        Text {
                            text: root.console-output;
                            color: #ecf0f1;
                            font-family: "Fira Code";
                            font-size: 12px;
                            wrap: word-wrap;
                            vertical-alignment: top;
                            horizontal-alignment: left;
                        }
                    }
                }
                
                // Command Input Bar
                Rectangle {
                    height: 40px;
                    background: #252526;
                    border-radius: 4px;
                    border-width: 1px;
                    border-color: #3e3e42;
                    
                    HorizontalLayout {
                        padding: 5px;
                        spacing: 10px;
                        
                        Text {
                            text: ">";
                            color: #2ecc71;
                            font-weight: 700;
                            vertical-alignment: center;
                            font-size: 16px;
                        }
                        
                        cmd-input := LineEdit {
                            text <=> root.command-input;
                            placeholder-text: "Enter G-code command...";
                            enabled: root.connected;
                            font-size: 14px;
                            horizontal-stretch: 1;
                            
                            accepted => {
                                if (self.text != "") {
                                    root.send-command(self.text);
                                    self.text = "";
                                }
                            }
                        }
                        
                        ConsoleToolButton {
                            icon: "âž¤";
                            width: 40px;
                            height: 30px;
                            tooltip: "Send Command";
                            enabled: root.connected && root.command-input != "";
                            base-color: #2ecc71;
                            hover-color: #27ae60;
                            clicked => {
                                if (root.command-input != "") {
                                    root.send-command(root.command-input);
                                    root.command-input = "";
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}
