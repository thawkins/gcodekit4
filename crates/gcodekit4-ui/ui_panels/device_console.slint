/// Device Console Panel Component
/// Displays device console output with clear and copy buttons

import { Button, TextEdit, LineEdit, VerticalBox, HorizontalBox, ScrollView } from "std-widgets.slint";
import { Theme } from "../ui/theme.slint";
import { StandardButton, StandardSidebar } from "../ui/ui_components/shared.slint";

export component DeviceConsolePanel inherits Rectangle {
    horizontal-stretch: 1.0;
    vertical-stretch: 1.0;
    background: Theme.background;
    
    in property <string> console-output: "";
    in property <bool> connected: false;
    in-out property <string> command-input: "";
    
    callback console-clear-clicked();
    callback console-copy-clicked();
    callback send-command(string);

    HorizontalLayout {
        spacing: 0px;

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // LEFT SIDEBAR: Actions
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        StandardSidebar {
            VerticalLayout {
                padding: Theme.padding;
                spacing: Theme.spacing;
                alignment: start;
                
                Rectangle {
                    background: #ff0000;
                    height: 80px;
                    border-radius: 4px;
                    
                    VerticalLayout {
                        padding: 5px;
                        alignment: center;
                        Text {
                            text: "The Console log scrolls down and the most recent entry is at the top.";
                            color: #ffffff;
                            wrap: word-wrap;
                            vertical-alignment: center;
                            horizontal-alignment: center;
                        }
                    }
                }
                
                Text {
                    text: "Console Actions";
                    font-weight: 700;
                    font-size: 12px;
                    color: Theme.text-secondary;
                }
                
                StandardButton {
                    text: "Clear";
                    icon: "ðŸ—‘";
                    tooltip: "Clear Console Output";
                    clicked => { root.console-clear-clicked(); }
                }
                
                StandardButton {
                    text: "Copy";
                    icon: "ðŸ“‹";
                    tooltip: "Copy to Clipboard";
                    clicked => { root.console-copy-clicked(); }
                }
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // MAIN AREA: Log & Input
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        Rectangle {
            background: Theme.background;
            
            VerticalLayout {
                padding: Theme.padding;
                spacing: Theme.spacing;
                
                // Console Output
                Rectangle {
                    background: Theme.background;
                    vertical-stretch: 1;
                    min-height: 100px;
                    
                    ScrollView {
                        width: 100%;
                        height: 100%;
                        viewport-width: parent.width;
                        
                        VerticalLayout {
                            alignment: start;
                            
                            Text {
                                text: root.console-output;
                                color: Theme.text-primary;
                                font-family: "Fira Code";
                                font-size: 12px;
                                wrap: word-wrap;
                            }
                        }
                    }
                }
                
                // Command Input Bar
                Rectangle {
                    height: 40px;
                    background: Theme.panel-background;
                    border-radius: 4px;
                    border-width: 1px;
                    border-color: Theme.border;
                    
                    HorizontalLayout {
                        padding: 5px;
                        spacing: 10px;
                        
                        Text {
                            text: ">";
                            color: Theme.success;
                            font-weight: 700;
                            vertical-alignment: center;
                            font-size: 16px;
                        }
                        
                        cmd-input := LineEdit {
                            text <=> root.command-input;
                            placeholder-text: "Enter G-code command...";
                            enabled: root.connected;
                            font-size: 14px;
                            horizontal-stretch: 1;
                            
                            accepted => {
                                if (self.text != "") {
                                    root.send-command(self.text);
                                    self.text = "";
                                }
                            }
                        }
                        
                        StandardButton {
                            icon: "âž¤";
                            width: 40px;
                            height: 30px;
                            tooltip: "Send Command";
                            enabled: root.connected && root.command-input != "";
                            primary: true;
                            clicked => {
                                if (root.command-input != "") {
                                    root.send-command(root.command-input);
                                    root.command-input = "";
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}
