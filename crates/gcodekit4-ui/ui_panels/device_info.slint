/// Device Information Panel
/// Display firmware type, version, and capabilities when device is connected

import { Button, VerticalBox, HorizontalBox, ScrollView, GridBox } from "std-widgets.slint";
import { Theme } from "../ui/theme.slint";
import { StandardButton, StandardSidebar } from "../ui/ui_components/shared.slint";

export struct CapabilityItem {
    name: string,
    enabled: bool,
    notes: string,
}

export component DeviceInfoPanel inherits Rectangle {
    background: Theme.background;
    
    in property <bool> connected: false;
    in property <string> firmware-type: "";
    in property <string> firmware-version: "";
    in property <string> device-name: "";
    in property <[CapabilityItem]> capabilities: [];
    
    callback refresh-clicked();
    callback copy-config-clicked();

    HorizontalLayout {
        // Sidebar
        StandardSidebar {
            VerticalLayout {
                padding: 15px;
                spacing: 20px;
                alignment: start;
                
                // Status Icon
                Rectangle {
                    height: 100px;
                    Text {
                        text: root.connected ? "ðŸ“ " : "ðŸ”Œ";
                        font-size: 64px;
                        horizontal-alignment: center;
                        vertical-alignment: center;
                    }
                }
                
                // Device Info
                VerticalLayout {
                    spacing: 5px;
                    Text { text: "DEVICE NAME"; font-size: 10px; color: Theme.text-muted; font-weight: 700; }
                    Text { text: root.connected ? root.device-name : "No Device"; font-size: 16px; color: Theme.text-primary; font-weight: 600; overflow: elide; }
                }

                VerticalLayout {
                    spacing: 5px;
                    Text { text: "FIRMWARE"; font-size: 10px; color: Theme.text-muted; font-weight: 700; }
                    Text { text: root.connected ? root.firmware-type : "-"; font-size: 14px; color: Theme.success; font-weight: 600; }
                }

                VerticalLayout {
                    spacing: 5px;
                    Text { text: "VERSION"; font-size: 10px; color: Theme.text-muted; font-weight: 700; }
                    Text { text: root.connected ? root.firmware-version : "-"; font-size: 14px; color: Theme.primary; font-family: "Fira Code"; }
                }
                
                Rectangle { height: 1px; background: Theme.sidebar-item-selected; }
                
                // Actions
                StandardButton {
                    text: "Refresh Info";
                    icon: "ðŸ”„";
                    tooltip: "Refresh Device Information";
                    enabled: root.connected;
                    clicked => { root.refresh-clicked(); }
                }
                
                StandardButton {
                    text: "Copy Config";
                    icon: "ðŸ“‹";
                    tooltip: "Copy Configuration to Clipboard";
                    enabled: root.connected;
                    clicked => { root.copy-config-clicked(); }
                }
                
                Rectangle { vertical-stretch: 1; }
            }
        }
        
        // Main Content
        Rectangle {
            background: Theme.background;
            
            if !root.connected : VerticalLayout {
                alignment: center;
                Text {
                    text: "Connect a device to view capabilities";
                    color: Theme.text-muted;
                    font-size: 16px;
                    horizontal-alignment: center;
                }
            }
            
            if root.connected : VerticalLayout {
                padding: 20px;
                spacing: 15px;
                
                Text {
                    text: "Firmware Capabilities";
                    font-size: 18px;
                    font-weight: 300;
                    color: Theme.text-primary;
                }
                
                ScrollView {
                    VerticalLayout {
                        spacing: 2px;
                        for cap[i] in root.capabilities : Rectangle {
                            height: 40px;
                            background: Math.mod(i, 2) == 0 ? Theme.panel-background : Theme.background;
                            border-radius: 4px;
                            
                            HorizontalLayout {
                                padding-left: 20px;
                                padding-right: 10px;
                                spacing: 20px;
                                
                                // Status Column
                                Rectangle {
                                    width: 80px;
                                    
                                    // Status Pill
                                    Rectangle {
                                        width: 100%;
                                        height: 24px;
                                        y: (parent.height - self.height) / 2;
                                        
                                        // Background with opacity
                                        Rectangle {
                                            border-radius: 12px;
                                            background: cap.enabled ? Theme.success : Theme.danger;
                                            opacity: 0.2;
                                        }
                                        
                                        // Text on top (full opacity)
                                        Text {
                                            text: cap.enabled ? "ENABLED" : "DISABLED";
                                            color: cap.enabled ? Theme.success : Theme.danger;
                                            font-size: 10px;
                                            font-weight: 700;
                                            horizontal-alignment: center;
                                            vertical-alignment: center;
                                        }
                                    }
                                }
                                
                                Text {
                                    text: cap.name;
                                    color: Theme.text-primary;
                                    font-size: 14px;
                                    width: 250px;
                                    vertical-alignment: center;
                                    overflow: elide;
                                }
                                
                                Text {
                                    text: cap.notes;
                                    color: Theme.text-muted;
                                    font-size: 12px;
                                    horizontal-stretch: 1;
                                    vertical-alignment: center;
                                    overflow: elide;
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}
