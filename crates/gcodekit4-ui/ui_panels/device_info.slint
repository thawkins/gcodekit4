/// Device Information Panel
/// Display firmware type, version, and capabilities when device is connected

import { Button, VerticalBox, HorizontalBox, ScrollView, GridBox } from "std-widgets.slint";

export struct CapabilityItem {
    name: string,
    enabled: bool,
    notes: string,
}

component InfoToolButton inherits Rectangle {
    in property <string> text;
    in property <string> icon;
    in property <bool> enabled: true;
    callback clicked;
    
    height: 40px;
    background: !root.enabled ? #34495e : (touch.has-hover ? #3d566e : #2c3e50);
    border-radius: 4px;
    border-width: 1px;
    border-color: #3d566e;
    
    HorizontalBox {
        alignment: center;
        spacing: 8px;
        if (root.icon != "") : Text { text: root.icon; font-size: 18px; color: #ecf0f1; vertical-alignment: center; }
        Text { text: root.text; font-size: 13px; color: #ecf0f1; vertical-alignment: center; }
    }
    touch := TouchArea {
        clicked => { root.clicked(); }
    }
}

export component DeviceInfoPanel inherits Rectangle {
    background: #1e1e1e;
    
    in property <bool> connected: false;
    in property <string> firmware-type: "";
    in property <string> firmware-version: "";
    in property <string> device-name: "";
    in property <[CapabilityItem]> capabilities: [];
    
    callback refresh-clicked();
    callback copy-config-clicked();

    HorizontalLayout {
        // Sidebar
        Rectangle {
            width: 250px;
            background: #2c3e50;
            
            VerticalLayout {
                padding: 15px;
                spacing: 20px;
                alignment: start;
                
                // Status Icon
                Rectangle {
                    height: 100px;
                    Text {
                        text: root.connected ? "ðŸ“ " : "ðŸ”Œ";
                        font-size: 64px;
                        horizontal-alignment: center;
                        vertical-alignment: center;
                    }
                }
                
                // Device Info
                VerticalLayout {
                    spacing: 5px;
                    Text { text: "DEVICE NAME"; font-size: 10px; color: #95a5a6; font-weight: 700; }
                    Text { text: root.connected ? root.device-name : "No Device"; font-size: 16px; color: #ecf0f1; font-weight: 600; overflow: elide; }
                }

                VerticalLayout {
                    spacing: 5px;
                    Text { text: "FIRMWARE"; font-size: 10px; color: #95a5a6; font-weight: 700; }
                    Text { text: root.connected ? root.firmware-type : "-"; font-size: 14px; color: #2ecc71; font-weight: 600; }
                }

                VerticalLayout {
                    spacing: 5px;
                    Text { text: "VERSION"; font-size: 10px; color: #95a5a6; font-weight: 700; }
                    Text { text: root.connected ? root.firmware-version : "-"; font-size: 14px; color: #3498db; font-family: "Fira Code"; }
                }
                
                Rectangle { height: 1px; background: #34495e; }
                
                // Actions
                InfoToolButton {
                    text: "Refresh Info";
                    icon: "ðŸ”„";
                    enabled: root.connected;
                    clicked => { root.refresh-clicked(); }
                }
                
                InfoToolButton {
                    text: "Copy Config";
                    icon: "ðŸ“‹";
                    enabled: root.connected;
                    clicked => { root.copy-config-clicked(); }
                }
                
                Rectangle { vertical-stretch: 1; }
            }
            
            // Border
            Rectangle { width: 1px; x: parent.width - 1px; background: #1a252f; }
        }
        
        // Main Content
        Rectangle {
            background: #1e1e1e;
            
            if !root.connected : VerticalLayout {
                alignment: center;
                Text {
                    text: "Connect a device to view capabilities";
                    color: #7f8c8d;
                    font-size: 16px;
                    horizontal-alignment: center;
                }
            }
            
            if root.connected : VerticalLayout {
                padding: 20px;
                spacing: 15px;
                
                Text {
                    text: "Firmware Capabilities";
                    font-size: 18px;
                    font-weight: 300;
                    color: #ecf0f1;
                }
                
                ScrollView {
                    VerticalLayout {
                        spacing: 2px;
                        for cap[i] in root.capabilities : Rectangle {
                            height: 40px;
                            background: Math.mod(i, 2) == 0 ? #252526 : #2d2d30;
                            border-radius: 4px;
                            
                            HorizontalLayout {
                                padding-left: 20px;
                                padding-right: 10px;
                                spacing: 20px;
                                
                                // Status Column
                                Rectangle {
                                    width: 80px;
                                    
                                    // Status Pill
                                    Rectangle {
                                        width: 100%;
                                        height: 24px;
                                        y: (parent.height - self.height) / 2;
                                        
                                        // Background with opacity
                                        Rectangle {
                                            border-radius: 12px;
                                            background: cap.enabled ? #2ecc71 : #e74c3c;
                                            opacity: 0.2;
                                        }
                                        
                                        // Text on top (full opacity)
                                        Text {
                                            text: cap.enabled ? "ENABLED" : "DISABLED";
                                            color: cap.enabled ? #2ecc71 : #e74c3c;
                                            font-size: 10px;
                                            font-weight: 700;
                                            horizontal-alignment: center;
                                            vertical-alignment: center;
                                        }
                                    }
                                }
                                
                                Text {
                                    text: cap.name;
                                    color: #ecf0f1;
                                    font-size: 14px;
                                    width: 250px;
                                    vertical-alignment: center;
                                    overflow: elide;
                                }
                                
                                Text {
                                    text: cap.notes;
                                    color: #95a5a6;
                                    font-size: 12px;
                                    horizontal-stretch: 1;
                                    vertical-alignment: center;
                                    overflow: elide;
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}
